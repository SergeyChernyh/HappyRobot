Универсальная коммуникационная среда для мобильных робототехнических комплексов (стек протоколов)

Ver. 0.4.0.3

Students Edition

2. Протокол взаимодействия робототехнических устройств и устройств удаленной обработки информации по защищенным каналам

2.1.     Сервисные команды и сообщения (установка соединения, активации уровней управления и т.п.)
2.1.1.   Согласование версии протокола
2.1.2.   Запрос информации об активных подключениях.
2.1.3.   Ответ на запрос информации об активных подключениях.
2.1.4.   Требование на повышение уровня управления
2.1.5.   Запрос на активацию уровня управления
2.1.6.   Запрос на деактивацию уровня управления
2.1.7.   Запрос на завершение соединения
2.1.8.   Завершение соединения
2.1.9    Результат выполнения команды.
2.2.     Получение конфигурации робототехнического устройства
2.2.1.   Запрос на получение версии конфигурации РУ
2.2.2.   Получение версии конфигурации РУ / сообщение об изменении версии конфигурации РУ
2.2.3.   Запрос на получение списка функций РУ
2.2.4.   Запрос на получение дифференциального списка функций РУ
2.2.5.   Получение списка функций РУ
2.2.6.   Запрос на получение конфигурации функции РУ
2.2.7.   Запрос на получение дифференциальной конфигурации функций РУ
2.2.8.   Получение конфигурации функции РУ
2.2.8.1  Не специфицированное устройство
2.2.8.2  Высокоуровневая двигательная функция
2.2.8.3. Одномерный датчик экстрацептивного сонарного типа
2.3.     Запрос и получение данных от функций робототехнического устройства
2.3.1.   Запрос на однократное получение данных от функции РУ
2.3.2.   Запрос на однократное получение измененных данных от функции РУ
2.3.3.   Запрос на получение изменений в данных от функции РУ
2.3.4.   Запрос на периодическое получение данных от функции РУ
2.3.5.   Отмена получения изменений в данных функции РУ
2.3.6.   Отмена периодического получения данных от функции РУ
2.3.7.   Получение данных от функции РУ
2.3.8.   Отказ в получении данных от функций РУ
2.3.9.   Изменение параметров функции РУ
2.3.10.  Запрос формата меток
2.3.11.  Получение формата меток

Краткое описание: Данный протокол предназначен для взаимодействия мобильных и стационарных робототехнических устройств в общей коммуникационной среде и удаленных центров обработки информации (Далее не делается различия между мобильными и стационарными робототехническими устройствами, если не оговорено иное). Является протоколом уровня приложений, ориентированным на работу в поточном режиме. Т.е. гарантии надежной доставки сообщений в порядке их отправки и средства обеспечения защищенности передаваемой информации ложатся на низлежащие протоколы. В незащищенных IP-сетях, данный протокол рекомендуется использовать для коммуникаций на базе протокола TCP с использованием IPSec в режиме ESP либо с использованием TLS.

Протокол содержит следующие группы команд и сообщений:

	Сервисные команды и сообщения (Установка соединения, активации уровней управления и т.п.)
	Получение конфигурации робототехнического устройства
	Запрос и получение данных от функций робототехнического устройства

Основные определения:

Мобильный робототехнический комплекс (МРК) - это совокупность мобильных робототехнических платформ и средств - мобильных робототехнических устройств (МРУ), и специализированных средств обработки информации (удаленных управляющих систем, специальных высокопроизводительных средств сбора и обработки информации и т.п.), объединенные выполнением определенных задач, объединенные информационными и управляющими потоками на базе управляемых и неуправляемых каналов.
Мобильное робототехническое устройство (МРУ) – это мобильная робототехническая платформа (мобильный робот), обладающая функциональной и логической законченностью, т.е. способная выполнять задачи, определяемые набором ее функций (ФРУ) в автономном или операторном режимах, и способная взаимодействовать с другими составляющими МРК по универсальному коммуникационному протоколу для мобильных робототехнических комплексов (УКПМРК). 
Стационарное робототехническое устройство (СРУ) – робототехническое устройство, обладающее ограниченной подвижностью, т.е. не способное менять самостоятельно свое местоположение в пространстве, при этом функционально и логически завершенное, т.е. способное выполнять задачи, определяемые набором его функций (ФРУ) в автономном или операторном режимах, и способное взаимодействовать с другими составляющими МРК по универсальному коммуникационному протоколу для мобильных робототехнических комплексов (УКПМРК).
Управляемый канал – канал обмена данными и управляющими сообщениями между составными частями мобильного робототехнического комплекса (МРК) посредством универсального коммуникационного протокола для мобильных робототехнических комплексов (УКПМРК).
Неуправляемый канал – канал обмена данными между составными частями МРК без участия УКПМРК.
Функция робототехнического устройства (ФРУ) – исполнительное устройство МРУ или СРУ, принадлежащее к одному из классов ФРУ, которое может выполнять определенную “деятельную” функцию (например, двигатели, манипуляторы типа “рука” и т.п.) либо предоставляющее некую информацию об окружающем пространстве и/или о состояние мобильного робототехнического  устройства, при этом не обладающее автономностью. 
Класс функций робототехнического устройства – класс управляемых исполнительных устройств, которыми можно управлять посредством управляемых каналов, либо класс датчиков, данные от которых можно получать посредством управляемых каналов на уровне МРК обладающих функциональной и логической общностью.

Общая структура пакета

Смещение | Поле      | Размер| Описание                  | Значение
(байт)   |           | (байт)|                           |
------------------------------------------------------------------------------
0x0000   | Маркер    | 2     | Маркер заголовка протокола| 0xA5D7
         | заголовка |       |                           |
         | протокола |       |                           |
---------------------------------------------------------|--------------------
0x0002   | Группа    | 2     | Определяет принадлежность | 0х0000 – сервисная
         |           |       | к группе команд/сообщений | группа и т.п. 
------------------------------------------------------------------------------
0x0004   | Тип       | 2     | Определяет тип сообщения  | 0х0000 –
         |           |       |                           | согласование
         |           |       |                           | версии протокола
         |           |       |                           | (группа 0х0000)
------------------------------------------------------------------------------
0х0006   | Номер     | 4     | Содержит номер сообщения в| 0x00000000 :
         | сообщения |       | рамках сеанса, каждое     | 0xFFFFFFFF
         |           |       | посылаемое сообщение      |
         |           |       | увеличивает данный номер  |
         |           |       | на 1                      |
------------------------------------------------------------------------------
0х000A   | Размер    | 4     | Размер поля данных        | 0x00000000 :
         | данных    |       | в байтах                  | 0xFFFFFFFF
------------------------------------------------------------------------------
0x000E   | Данные    | Х     | Поле данных. Длина поля и |
         |           |       | формат содержащихся данных|
         |           |       | зависти от группы и типа  |
         |           |       | сообщения                 |

2.1. Сервисные команды и сообщения (установка соединения, активации уровней управления и т.п.)

Краткое описание: Группа команд и сообщений предназначенная для управления потоком управляющих сообщений, состоянием коммуникационного инфраструктуры (коммуникационного графа) и т.п.
Код группы: 0х0000

2.1.1. Согласование версии протокола

Источник: УЦОИ, РУ
Код типа: 0х0000
Размер поля данных: 2 байта
Поле данных: В поле данных содержится версия управляющего протокола. Текущая версия протокола 0х0000.
Описание: УЦОИ инициирует посылку сообщения с желаемой версией протокола, РУ отвечает сообщением с желаемой версий протокола. Если версии совпадают, то считается, что версия протокола выбрана и разрешаются коммуникации в соответствии с данной версией. Если версии не совпали и УЦОИ устраивает версия протокола, предложенная РУ, то он посылает сообщение с этим номером версии, в противном случае понижает (выбирает следующую по приоритету) версию. Согласование версии протокола подобным способом продолжается до тех пор, пока не будет согласована версия протокола. Версия 0х0000 должна поддерживаться всеми устройствами.
Примечание: Обязательное сообщение, должно поддерживаться всеми версиями протокола. Пока не согласована версия протокола, все остальные команды и сообщения от УЦОИ игнорируются РУ.

2.1.2. Запрос информации об активных подключениях.

Источник: УЦОИ
Код типа: 0х0001
Размер поля данных: 0 байт
Поле данных: нет
Описание: С помощью данного сообщения УЦОИ запрашивает РУ информацию о состоянии коммуникационной системы РУ.
Примечание: Обязательная команда для версии протокола 0х0000

2.1.3. Ответ на запрос информации об активных подключениях.

Источник: РУ
Код типа: 0х0002
Размер поля данных: 8 байт
Поле данных: 
1) Общее количество слотов для управляющих станций – 1 байт
2) Количество свободных слотов для управляющих станций – 1 байт
3) Максимальный приоритет УС – 1 байт
4) Минимальный приоритет УС – 1 байт
5) Общее количество слотов для станций мониторов – 1 байт
6) Количество свободных слотов для станций мониторов – 1 байт
7) Максимальный приоритет монитора – 1 байт
8) Минимальный приоритет монитора – 1 байт

Описание: С помощью данного сообщения РУ отвечает УЦОИ о состоянии коммуникационной системы РУ (количестве слотов для подключений).
Примечание: Обязательная команда для версии протокола 0х0000

2.1.4. Требование на повышение уровня управления

…

2.1.5. Запрос на активацию уровня управления

…

2.1.6. Запрос на деактивацию уровня управления

…

2.1.7. Запрос на завершение соединения

Источник: УЦОИ
Код типа: 0х0006
Размер поля данных: 2 байта
Поле данных: нет

2.1.8. Завершение соединения

Источник: РУ
Код типа: 0х0007
Размер поля данных: 2 байта
Поле данных: Причина разрыва – 2 байта
0х0000 – по запросу данного УЦОИ
0х01ХХ – недостаточен приоритет (ХХ -  минимальный приоритет для подключения)
0х02ХХ – нет свободных слотов (ХХ – минимальный приоритет подключения)
0х0300 – уход в автономный режим
0хFF00 – критичный уровень питания (требуется отключение РУ)
0хFF01 – сбой в ПО (требуется перезапуск системы)
0хFF02 – сбой в аппаратном обеспечении (требуется перезапуск системы)

2.1.9 Результат выполнения команды.

Источник: РУ
Код типа: 0х0008
Размер поля данных: 6 байт
Поле данных:
1) Номер команды, для которой получен результат ее выполнения - 4 байта
2) Код результата – 2 байта. Данные коды применимы для всех команд:
Код 0х0000 – команда в процессе выполнения.
Код 0х8000 – команда получена, выполнение команды отложено.
Код 0xFFFF – команда не поддерживается устройством.
Код 0xFFFE – неверный формат команды.

Признак кода успешного завершения 0 в старшем разряде (кроме кода 0х0000). Признак аварийного завершения 1 в старшем разряде (кроме кода 0х8000). Коды зависят от типа команды.

Описание: С помощью данного сообщения РУ сигнализирует о степени/результате выполнения команды с определенным номером.
Примечание: Обязательная команда для версии протокола 0х0000

2.2. Получение конфигурации робототехнического устройства

Краткое описание: Группа команд и сообщений предназначенная для получения от РУ информации о составе РУ, его функциях, параметрах функций, команды управления предустановленными  конфигурациями и т.п.
Код группы: 0х0001
Поддерживается следующие группы функциональных устройств:

0х0000 – универсальное (не специфицированное) устройство
0х0001 – высокоуровневая двигательная функция для наземных МРУ (с возможностью поворота на месте)
0х0002 – одномерный датчик экстрацептивного сонарного типа (сонары, точечные лазерные дальномеры и т.п.)
0х0003 – двумерный датчик экстрацептивного сонарного типа (сканирующие лазерные дальномеры и т.п.)
0х0004 – трехмерный датчик экстрацептивного сонарного типа (сканирующие лазерные дальномеры и т.п.)
0х0005 – датчики положения, ориентации в пространстве, одометры
0х0006 – функция управления питанием
0х0007 – канал связи 
и т.п.

Для однотипных функций РУ применяется сквозная нумерация.
Функции РУ обладают наборами параметров доступных для чтения, записи, чтения/записи, часть параметров являются конфигурационными. Параметр является конфигурационным, если он влияет на быстродействие функции, размерность данных, набор параметров функции и т.п. 
Конфигурацией РУ называется набор функциональных устройств, входящих в его состав, каналы связи между ними и значение их конфигурационные параметров.

2.2.1. Запрос на получение версии конфигурации РУ

Источник: УЦОИ
Код типа: 0х0000
Размер поля данных: 0 байт
Поле данных: нет

Описание: С помощью данной команды УЦОИ запрашивает версию конфигурации РУ – 8  байтовое беззнаковое число целого типа. Ответом на данную команду является сообщение 2.2.2.
Примечание: Обязательная команда. Любое изменение в конфигурации РУ (в конфигурационных параметрах функций) влечет изменение номера версии конфигурации.

2.2.2. Получение версии конфигурации РУ / сообщение об изменении версии конфигурации РУ

Источник: РУ
Код типа: 0х0001
Размер поля данных: 8 байт
Поле данных: версия конфигурации РУ – 8 байт (беззнаковое целое)

Описание: Сообщение является ответом на команду 2.2.1. Также посылается всем УЦОИ при изменении конфигурации РУ.
Примечание: Обязательная команда. Любое изменение в конфигурации РУ (в конфигурационных параметрах функций) влечет изменение номера версии конфигурации.

2.2.3. Запрос на получение списка функций РУ

Источник: УЦОИ
Код типа: 0х0002
Размер поля данных: 0 байт
Поле данных: нет

Описание: С помощью данной команды УЦОИ запрашивает список функций входящий в состав РУ. Ответом на данную команду является сообщение 2.2.5.
Примечание: Обязательная команда.

2.2.4. Запрос на получение дифференциального списка функций РУ

Источник: УЦОИ
Код типа: 0х0003
Размер поля данных: 8 байт
Поле данных: версия конфигурации РУ – 8 байт (беззнаковое целое)

Описание: С помощью данной команды УЦОИ запрашивает список функций входящий в состав РУ, в которых произошли изменения в конфигурации по сравнению с версией конфигурации имеющейся у УЦОИ, которая передается параметром. Ответом на данную команду является сообщение 2.2.5.
Примечание: Необязательная команда. РУ может ответить дифференциальным списком, полным списком функций или кодом ошибки «команда не поддерживается устройством»

2.2.5. Получение списка функций РУ

Источник: УЦОИ
Код типа: 0х0004
Размер поля данных: Х байт
Поле данных: 
1) Количество функций – 4 байта
2) Код функции – 2 байта
3) Номер функции – 2 байта

Описание: С помощью данной команды РУ информирует УЦОИ о количестве функций, входящих в состав РУ, и их типе. Является ответом на команды 2.2.3 и 2.2.4. В случае ответа на команду 2.2.4 передается не весь список функций, а только те, в конфигурации которых произошли изменения по сравнению с версией, имеющейся у УЦОИ.
Примечание: Обязательная команда.

2.2.6. Запрос на получение конфигурации функции РУ

Источник: УЦОИ
Код типа: 0х0005
Размер поля данных: 8 байт
Поле данных:
1) Код функция – 2 байта
2) Номер функции – 2 байта

Описание: С помощью данной команды УЦОИ запрашивает список параметров конкретной функций входящий в состав РУ. Ответом на данную команду является сообщение 2.2.8.
Примечание: Обязательная команда. 

2.2.7. Запрос на получение дифференциальной конфигурации функций РУ

Источник: УЦОИ
Код типа: 0х0006
Размер поля данных: 16 байт
Поле данных: 
1) версия конфигурации РУ – 8 байт (беззнаковое целое)
2) Код функция – 2 байта
3) Номер функции – 2 байта

Описание: С помощью данной команды УЦОИ запрашивает список параметров конкретной функции, входящей в состав РУ, в которой произошли изменения в конфигурации по сравнению с версией конфигурации имеющейся у УЦОИ, которая передается параметром. Ответом на данную команду является сообщение 2.2.8.
Примечание: Необязательная команда. РУ может ответить дифференциальным списком параметров, полным списком параметров функции или кодом ошибки «команда не поддерживается устройством»

2.2.8. Получение конфигурации функции РУ

Источник: РУ
Код типа: 0х0007
Размер поля данных: Х байт

Поля данных различаются в зависимости от типа функционального устройства.

2.2.8.1 Не специфицированное устройство

…

2.2.8.2 Высокоуровневая двигательная функция

Поле данных:
1) Код функции – 2 байта (0х0001)
2) Номер функции – 2 байта
3) Количество параметров – 1 байт
4) Тип параметра – 1 байт:
0х00 – не поддерживается
0х01 – параметр только на чтение
0х02 – параметр только на запись
0х03 – параметр на чтение и запись
5) Код параметра – 1 байт:
0х00 –  абсолютная координата в декартовой системе координат по Х (для МРК)
0х01 –  абсолютная координата в декартовой системе координат по Y (для МРК)
0x02 – абсолютная ориентация относительно северного магнитного полюса Земли
0х03 – относительная координата в декартовой системе координат по Х 
0х04 – относительная координата в декартовой системе координат по Y
0х05 – относительное направление ориентации
0х06 – линейная скорость движения
0х07 – линейное ускорение
0х08 – угловая скорость (положительная для вращения по часовой стрелке)
0х09 – угловое ускорение
0х0A – Максимально допустимая линейная скорость движения
0x0B – Максимально допустимое линейное ускорение
0x0C – Максимально допустимая угловая скорость
0x0D – Максимально допустимое угловое ускорение
0х0E – Установленная линейная скорость движения
0x0F – Установленное линейное ускорение
0x10 – Установленная угловая скорость
0x11 – Установленное угловое ускорение
0x12 – Проследовать в точку с абсолютными координатами в декартовой системе координат по кратчайшей траектории (выполняется поворот и выполняется движение по прямой с установленными характеристиками движения)
0x13 – Проследовать в точку с относительными координатами в декартовой системе координат по кратчайшей траектории (см. код 12)
0x14 – Проследовать в точку с относительными координатами в декартовой системе координат кратчайшей траектории (от текущего положения) (см. код 12)
0х15 – Повернуть на угол относительно северного магнитного полюса Земли (положительное значение для поворота по часовой стрелке)
0х16 – Повернуть на угол относительно направления ориентации (положительное значение для поворота по часовой стрелке)
0х17 – Повернуть на угол относительно текущего направления ориентации (положительное значение для поворота по часовой стрелке)
0х18 – Прямолинейное движение с установленными параметрами движения (может выполняться одновременно с 0х19)
0х19 – Поворот с установленными параметрами движения (может выполняться одновременно с 0х18)
0х1A – Экстренный останов
…
6) Требуемый уровень управления для чтения параметра – 1 байт
7) Требуемый уровень управления для записи параметра – 1 байт 
8) Количество полей данных – 1 байт: каждый параметр описывается полями 9-16
9) Размер поля под величину в байтах – 1 байт: степень двойки. (0 – 1 байт, 1 – 2 байта и  т.д.) 
10) Флаги формат величины (действительное/целое, знаковое/беззнаковое) – 1 байт:
0х01 – действительное (1), 0х02 – знаковое (1). Пример 0х00 – целое беззнаковое.
11) Максимальное значение параметра – размер зависит от поля 9
12) Минимальное значение параметра – размер зависит от поля 9
13) Точность (шаг) управления – размер зависит от поля 9
14) Код физической величины  – 2 байта: (см. таблицу П1)

Описание: С помощью данной команды РУ оповещает УЦОИ о наличии возможности высокоуровневого управления перемещением робототехнического устройства.
Примечание: Если параметр не поддерживается, то поля 6-14 в пакете отсутствуют. РУ может не передавать УЦОИ неподдерживаемые параметры. В одном пакете может передаваться несколько параметров, либо они могут передаваться в разных пакетах.

…

2.2.8.3. Одномерный датчик экстрацептивного сонарного типа

Поле данных:
1) Код функции – 2 байта (0х0002)
2) Номер функции – 2 байта
3) Количество параметров – 1 байт
4) Тип параметра – 1 байт:
0х00 – не поддерживается
0х01 – параметр только на чтение
0х02 – параметр только на запись
0х03 – параметр на чтение и запись
5) Код параметра – 1 байт:
0х00 – координата в декартовой системе координат по Х базовой точка отсчета относительно центральной точки РУ
0х01 – координата в декартовой системе координат по Y базовой точка отсчета относительно центральной точки РУ 
0x02 – координата в декартовой системе координат по Z базовой точка отсчета относительно центральной точки РУ 
0х03 – координата в декартовой системе координат по Х вектора направления измерений
0х04 – координата в декартовой системе координат по Y вектора направления измерений
0х05 – координата в декартовой системе координат по Z вектора направления измерений
0х06 – период измерений
0х07 – минимальное измеряемое расстояние
0х08 – максимальное измеряемое расстояние
0х09 – точность измерений
0х0A – текущее расстояние
…
6) Требуемый уровень управления для чтения параметра – 1 байт
7) Требуемый уровень управления для записи параметра – 1 байт 
8) Количество полей данных – 1 байт: каждый параметр описывается полями 9-16
9) Размер поля под величину в байтах – 1 байт: степень двойки. (0 – 1 байт, 1 – 2 байта и  т.д.) 
10) Флаги формат величины (действительное/целое, знаковое/беззнаковое) – 1 байт:
0х01 – действительное (1), 0х02 – знаковое (1). Пример 0х00 – целое беззнаковое.
11) Максимальное значение параметра – размер зависит от поля 9
12) Минимальное значение параметра – размер зависит от поля 9
13) Точность (шаг) управления – размер зависит от поля 9
14) Код физической величины  – 2 байта: (см. таблицу П1)

Описание: С помощью данной команды РУ оповещает УЦОИ о наличии датчиков сонарного типа, позволяющих измерять расстояние до окружающих объектов.

Примечание: Если параметр не поддерживается, то поля 6-14 в пакете отсутствуют. РУ может не передавать УЦОИ неподдерживаемые параметры. В одном пакете может передаваться несколько параметров, либо они могут передаваться в разных пакетах.

2.3. Запрос и получение данных от функций робототехнического устройства

Краткое описание: Группа команд и сообщений предназначенная для получения от РУ информации с функций РУ и управления функциями РУ
Код группы: 0х0002

Содержит следующие команды
	Запрос на однократное получение данных от функции РУ
	Запрос на однократное получение измененных данных от функции РУ
	Запрос на получение изменений в данных от функции РУ
	Запрос на периодическое получение данных от функции РУ
	Отмена получения изменений в данных функции РУ
	Отмена периодического получения данных от функции РУ
	Получение данных от функции РУ
	Отказ в получении данных от функций РУ
	Изменение параметров функции РУ
	Запрос формата меток
	Получение формата меток

2.3.1. Запрос на однократное получение данных от функции РУ

Источник: УЦОИ
Код типа: 0х0000
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Флаги меток – 1байт
	Не сопровождать параметр никакими метками – 0х00
	Сопровождать параметр временной меткой – 0х01
	Сопровождать параметр меткой абсолютной координаты ХY – 0х02 
	Сопровождать параметр меткой абсолютной координаты Z – 0х04
	Сопровождать параметр меткой абсолютной ориентации – 0х08
	Сопровождать параметр меткой относительной координаты ХY – 0х10 
	Сопровождать параметр меткой относительной координаты Z – 0х20
	Сопровождать параметр меткой относительной ориентации – 0х40
	…

Описание: Команда предназначена для запроса однократного получения значения конкретных параметров от конкретной функции РУ

Примечание: Обязательная команда
Примечание: РУ отвечает на запрос либо пакетом 2.3.7, либо 2.3.8 в зависимости от настроек РУ и уровня управления УЦОИ, в пакет включается последняя доступная версия данных 
Примечание: Если установлен флаг координаты Z, то соответствующие метки ориентации 3х параметрические (), а если сброшен,  то используется только 1 параметр

2.3.2. Запрос на однократное получение измененных данных от функции РУ

Источник: УЦОИ
Код типа: 0х0001
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Флаги меток – 1байт
	Не сопровождать параметр никакими метками – 0х00
	Сопровождать параметр временной меткой – 0х01
	Сопровождать параметр меткой абсолютной координаты ХY – 0х02 
	Сопровождать параметр меткой абсолютной координаты Z – 0х04
	Сопровождать параметр меткой абсолютной ориентации – 0х08
	Сопровождать параметр меткой относительной координаты ХY – 0х10 
	Сопровождать параметр меткой относительной координаты Z – 0х20
	Сопровождать параметр меткой относительной ориентации – 0х40
	…

Описание: Команда предназначена для запроса однократного получения значений конкретных параметров от конкретной функции РУ после их изменения


Примечание: РУ отвечает на запрос либо пакетом 2.3.7, либо 2.3.8 в зависимости от настроек РУ и уровня управления УЦОИ, в пакет отсылается после того, как получены обновленные версии всех доступных УЦОИ параметров, перечисленных в запросе, если к моменту отправки пакета доступны несколько версий какого-либо параметра, то включается последняя доступная версия данных
Примечание: Если установлен флаг координаты Z, то соответствующие метки ориентации 3х параметрические (), а если сброшен,  то используется только 1 параметр

2.3.3. Запрос на получение изменений в данных от функции РУ

Источник: УЦОИ
Код типа: 0х0002
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Флаги меток – 1байт
	Не сопровождать параметр никакими метками – 0х00
	Сопровождать параметр временной меткой – 0х01
	Сопровождать параметр меткой абсолютной координаты ХY – 0х02 
	Сопровождать параметр меткой абсолютной координаты Z – 0х04
	Сопровождать параметр меткой абсолютной ориентации – 0х08
	Сопровождать параметр меткой относительной координаты ХY – 0х10 
	Сопровождать параметр меткой относительной координаты Z – 0х20
	Сопровождать параметр меткой относительной ориентации – 0х40
	…

Описание: Команда предназначена для запроса постоянного получения значений конкретных параметров от конкретной функции РУ после их изменения

Примечание: РУ отвечает на запрос либо пакетом 2.3.7, либо 2.3.8 в зависимости от настроек РУ и уровня управления УЦОИ, в пакет отсылается после того, как получена обновленная версии любого из доступных УЦОИ параметров, перечисленных в запросе, если к моменту отправки пакета доступны несколько измененных параметров, то в пакет включаются все эти параметры, не измененные параметры ко времени отправки пакета не передаются.
Примечание: Если установлен флаг координаты Z, то соответствующие метки ориентации 3х параметрические (), а если сброшен,  то используется только 1 параметр

2.3.4. Запрос на периодическое получение данных от функции РУ

Источник: УЦОИ
Код типа: 0х0003
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Флаги меток – 1байт
	Не сопровождать параметр никакими метками – 0х00
	Сопровождать параметр временной меткой – 0х01
	Сопровождать параметр меткой абсолютной координаты ХY – 0х02 
	Сопровождать параметр меткой абсолютной координаты Z – 0х04
	Сопровождать параметр меткой абсолютной ориентации – 0х08
	Сопровождать параметр меткой относительной координаты ХY – 0х10 
	Сопровождать параметр меткой относительной координаты Z – 0х20
	Сопровождать параметр меткой относительной ориентации – 0х40
	Период передачи параметра в микросекундах – 4 байта
	…

Описание: Команда предназначена для запроса периодического получения значений конкретных параметров от конкретной функции РУ в не зависимости от их изменнеия

Примечание: РУ отвечает на запрос либо пакетом 2.3.7, либо 2.3.8 в зависимости от настроек РУ и уровня управления УЦОИ, в пакет отсылается после наступления времени передачи параметра, если к моменту отправки пакета наступило время передачи нескольких параметров, то в пакет включаются все эти параметры; параметр передается в независимости изменился он или нет за период прошедший с прошлой отправки.
Примечание: Если установлен флаг координаты Z, то соответствующие метки ориентации 3х параметрические (), а если сброшен,  то используется только 1 параметр

2.3.5. Отмена получения изменений в данных функции РУ

Источник: УЦОИ
Код типа: 0х0004
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	…

Описание: Команда предназначена для отмены постоянного получения значений конкретных параметров от конкретной функции РУ после их изменения

Примечание: 

2.3.6. Отмена периодического получения данных от функции РУ

Источник: УЦОИ
Код типа: 0х0005
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	…
Описание: Команда предназначена для отмены периодического получения значений конкретных параметров от конкретной функции РУ 

Примечание: 

2.3.7. Получение данных от функции РУ

Источник: РУ
Код типа: 0х0006
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Флаги меток – 1байт
	Метки отсутствуют – 0х00
	Есть временная метка – 0х01
	Есть метка абсолютной координаты ХY – 0х02 
	Есть метка абсолютной координаты Z – 0х04
	Есть метка абсолютной ориентации – 0х08
	Есть метка относительной координаты ХY – 0х10 
	Есть метка относительной координаты Z – 0х20
	Есть метка относительной ориентации – 0х40
	Временная метка – формат и размерность передается РУ командой 2.9.11.
	Метка абсолютной координаты XY – формат и размерность передается РУ командой 2.9.11.
	Метка абсолютной координаты Z – формат и размерность передается РУ командой 2.9.11.
	Метка абсолютной ориентации – формат и размерность передается РУ командой 2.9.11.
	Метка относительной координаты ХY – формат и размерность передается РУ командой 2.9.11.
	Метка относительной координаты Z – формат и размерность передается РУ командой 2.9.11.
	Метка относительной ориентации – формат и размерность передается РУ командой 2.9.11.
	Значение параметра – формат и размер зависит от параметра
	…

Описание: Сообщение предназначено для получения значений параметров функций РУ. Является ответом на команды 2.3.1 – 2.3.4.

Примечание: Обязательное сообщение
Примечание: Поля 6-12 присутствуют в зависимости от значения поля 5 
Примечание: Если установлен флаг координаты Z, то соответствующие метки ориентации 3х параметрические (), а если сброшен,  то используется только 1 параметр

2.3.8. Отказ в получении данных от функций РУ

Источник: РУ
Код типа: 0х0007
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Код отказа – 1 байт
	…

Описание: Сообщение предназначено отказа УЦОИ в получении значений параметров функции РУ. Является ответом на команды 2.3.1 – 2.3.4. 

Примечание: Обязательное сообщение
Примечание: В сообщение перечисляются все параметры из запрошенных командами 2.3.1 – 2.3.4, которые РУ не может передать УЦОИ. Причина отказа содержится в поле «код отказа»: 0х00 – параметр не поддерживается функцией РУ (больше не поддерживается),  любое другое значение уровень управления необходимый для чтения параметра.

2.3.9. Изменение параметров функции РУ

Источник: УЦОИ
Код типа: 0х0008
Размер поля данных: Х байт
Поле данных:
	Код функции – 2 байта
	Номер функции – 2 байта
	Количество параметров – 1 байт
	Код параметра – 1 байт
	Значение параметра – формат и длина зависти от параметра
	…

Описание: Команда предназначена для изменения параметров функций РУ.

Примечание: Обязательное сообщение
Примечание: Если какой-либо из параметров не может быть изменен, то выдается сообщение об ошибки, а изменение остальных параметров также не происходит. При необходимости гарантированного изменения какого-либо параметра, его необходимо включать в отдельную команду

2.3.10. Запрос формата меток

Источник: УЦОИ
Код типа: 0х0009
Размер поля данных: 0 байт
Поле данных: нет

Описание: С помощью данной команды УЦОИ запрашивает РУ о типе и формате поддерживаемых меток

2.3.11. Получение формата меток

Источник: РУ
Код типа: 0х0009
Размер поля данных: 0 байт
Поле данных: нет
	Флаги меток – 1байт
	Метки не поддерживаются  – 0х00
	Поддерживаются временные метки – 0х01
	Поддерживаются метки абсолютной координаты ХY – 0х02 
	Поддерживаются метки абсолютной координаты Z – 0х04
	Поддерживаются метки абсолютной ориентации – 0х08
	Поддерживаются метки относительной координаты ХY – 0х10 
	Поддерживаются метки относительной координаты Z – 0х20
	Поддерживаются метки относительной ориентации – 0х40
	Размер поля под величину в байтах – 1 байт: степень двойки. (0 – 1 байт, 1 – 2 байта и  т.д.) 
	Флаги формата величины (действительное/целое, знаковое/беззнаковое) – 1 байт: 0х01 – действительное (1), 0х02 – знаковое (1). Пример 0х00 – целое беззнаковое.
	Максимальное значение метки – размер зависит от поля 2
	Минимальное значение метки – размер зависит от поля 2
	Точность (шаг) управления – размер зависит от поля 2
	Код физической величины  – 2 байта: (см. таблицу П1)

Примечание: Если установлен флаг координаты Z, то соответствующие метки ориентации 3х параметрические (), а если сброшен,  то используется только 1 параметр
Примечание: Количество описателей меток зависит от поля 1, порядок описания меток идет в порядке увеличения разряда флага


